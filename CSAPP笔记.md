# 1.1 信息就是位+上下文

如hello程序的生命周期是从一个**源程序**（源文件）开始的，源程序就是由值0和1组成的位（比特）序列，8个位被组织成一组，称为**字节**，每个字节就表示程序中的某些文本字符。

像hello.c这样的只由ASCII祖父构成的文件叫文本文件，所有其他文件都称为**二进制文件**。

# 1.2 程序被其他程序翻译成不同的格式

每条C语句都必须被其他程序转化为一系列低级的低级的**机器语言指令**，再将这些指令按照称为**可执行目标程序**的格式打好包（如Windows的exe），目标程序也叫可执行目标文件。

下面是一个hello.c程序在linux的gcc编译器翻译的过程

##### 1.预处理阶段

预处理器（cpp）根据#开头文件读取头文件的内容，直接插入程序文本中，将hello.c转化成hello.i

##### 2.编译阶段

编译器（cll）把文本文件hello.i翻译成hello.s，这其中包含一个汇编语言程序，其中的文本有用一种文本格式来描述一条低级机器语言指令

##### 3.汇编阶段

然后汇编器（as）把hello.s反其成机器语言指令，把指令打包成一种叫做可重定位目标程序（relocatable object program）的格式，这时的hello.o文件就是一个二进制文件，包含的字节就是指令编码

##### 4.链接阶段

例如hello程序中调用了printf函数，它存在于printf.o这个单独的预编译好了的目标文件中，链接器（Id）负责将这些.o文件合并，最后得到hello文件，是可执行文件。

# 1.3 了解编译系统如何工作是大有益处的

1.优化程序性能

2.理解***链接***时出现的错误

3.避免安全漏洞 如缓冲区溢出错误

# 1.4 处理器读并解释储存在内存中的指令

如shell，一个命令行解释器，可以加载并运行编程源文件。

#### 1.4.1 系统的硬件组成

##### 1.总线

贯穿整个硬件系统的是一组电子管道，叫**总线**，通常总线被设计成传送定长的字节块，也就是字

字长与系统位数有关（64>8, 32>4）

##### 2.I/O设备

input和output设备，键盘鼠标，显示器，磁盘驱动器

每个设备通过一个**控制器**或**适配器**与I/O总线相连。

控制器是设备本身或是主板上的芯片组，适配器是插在主板插槽上的卡。

##### 3.主存

主存是临时存储设备，主存是由一组**动态随机存取存储器（DRAM）**组成的。从逻辑上来说，存储器是一个线性的字节数组，每个字节都有其**唯一的地址（数组索引）**

##### 4.处理器

CPU，是解释或执行存储在主存中指令的引擎。处理器的核心是一个大小为一个字的**存储设备（寄存器）**，称为**程序计数器**（PC，注：此PC非彼PC），在**任何时刻**，PC都指向主存中的**某条机器语言指令（即含有该条指令的地址）**。

处理器按照指令执行模型来操作，这个模型是由**指令集架构**决定的。处理器从程序计数器指向的内存处读取指令，解释指令中的位，执行完后更新PC指向下一个指令，但是**下一条指令<u>并不一定</u>和在内存中刚刚执行的指令<u>相邻</u>**。这些简单操作并不多，围绕**主存**、寄存器文件（register file）和**算术/逻辑单元（ALU）**进行，每个寄存器都有**<u>唯一</u>**的名字，CPU在指令的要求下可能会执行这些操作

###### 加载

从**主存**复制一个字节或字到**寄存器**覆盖掉原来的内容

###### 存储

从**寄存器**复制一个字节或字到**主存**的某个位置覆盖掉原来的内容

###### 操作

把**两个寄存器**内容复制到**ALU**，ALU对这两个字做算术运算，并将结果放到**一个寄存器**上覆盖原来的内容。

###### 跳转

从**指令**本身抽取一个字，并将这个字复制到**PC**中覆盖掉原来的值

##### 1.4.2 运行hello程序

都是图

# 1.5 高速缓存至关重要

hello程序的机器指令最初存放在磁盘上，当加载时，先复制到主存，再复制到处理器，printf函数也是。

处理器从寄存器文件（但只存储几百字节的信息）中读取数据比主存中读快几乎100倍，但从磁盘驱动器上读取比在主存中读取慢1000万倍，所以采用**高速缓存存储器（cache memory，简称cache或高速缓存）**作为**暂时**的集结区域，存在处理器近期可能会需要的信息。

**L1高速缓存**的容量可以有数万字节，访问速度几乎和存储器文件一样快，然后还有**L2高速缓存**，容量数十万到数百万字节，比访问L1时间长5倍，但还是比访问主存快。L1和L2是用一种叫做**静态随机访问存储器（SRAM）**的硬件技术实现的

系统可以获得一个很大的存储器，同时访问速度也很快，这是利用了高速缓存的**局部性**原理，即**程序具有访问局部区域里的数据和代码的趋势**。让高速缓存里存放可能经常访问的数据，大部分的内存操作都能在快速的高速缓存中完成。

# 1.6 存储设备形成层次结构

在处理器和一个较大较慢的设备之间插入一个更快更小的存储设备是普遍思想，具体图看书

# 1.7 操作系统管理硬件

shell加载和hello程序不是直接访问IO设备，而是通过**操作系统**提供的服务来实现对它们的访问。

**文件**是对**IO设备**的抽象表示，虚拟内存是对**主存**和**磁盘IO设备**的抽象表示，进程则是对**处理器**、主存和**IO设备**的抽象表示。

##### 1.7.1 进程

进程是操作系统对一个正在运行的程序的一种抽象，在一个系统上可以同时运行多个好像在独立占用硬件的进程。